<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>Class: Fusioncharts::DbJsDataurlController</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Script-Type" content="text/javascript" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript">
  // <![CDATA[

  function popupCode( url ) {
    window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
  }

  function toggleCode( id ) {
    if ( document.getElementById )
      elem = document.getElementById( id );
    else if ( document.all )
      elem = eval( "document.all." + id );
    else
      return false;

    elemStyle = elem.style;
    
    if ( elemStyle.display != "block" ) {
      elemStyle.display = "block"
    } else {
      elemStyle.display = "none"
    }

    return true;
  }
  
  // Make codeblocks hidden by default
  document.writeln( "<style type=\"text/css\">div.method-source-code { display: none }</style>" )
  
  // ]]>
  </script>

</head>
<body>



    <div id="classHeader">
        <table class="header-table">
        <tr class="top-aligned-row">
          <td><strong>Class</strong></td>
          <td class="class-name-in-header">Fusioncharts::DbJsDataurlController</td>
        </tr>
        <tr class="top-aligned-row">
            <td><strong>In:</strong></td>
            <td>
                <a href="../../files/app/controllers/fusioncharts/db_js_dataurl_controller_rb.html">
                app/controllers/fusioncharts/db_js_dataurl_controller.rb
                </a>
        <br />
            </td>
        </tr>

        <tr class="top-aligned-row">
            <td><strong>Parent:</strong></td>
            <td>
                <a href="../ApplicationController.html">
                ApplicationController
               </a>
            </td>
        </tr>
        </table>
    </div>
  <!-- banner header -->

  <div id="bodyContent">



  <div id="contextContent">

    <div id="description">
      <p>
This controller shows how to generate a pie-chart by retrieving values of
the total output quantities produced in factories with their names On
clicking on a pie-section, the detailed date-wise manufacture of each
quantity produced by that factory is displayed as a chart on the same page.
In this example, we show a combination of database + JavaScript (dataURL
method) rendering using FusionCharts. The entire example can be summarized
as under. This example shows the break-down of factory wise output
generated. In a pie chart, we first show the sum of quantity generated by
each factory. These pie slices, when clicked would show detailed date-wise
output of that factory. The detailed data would be dynamically pulled by
the column chart from another page. There are no page refreshes required.
Everything is done on one single page. The XML data for the pie chart is
fully created at run-time. Controller interacts with the database and
creates the XML for this using Builder template. Now, for the column chart
(date-wise output report), each time we need the data we dynamically submit
request to the server with the appropriate factoryId. The server responds
with an XML document, which we accept and update chart at client side.
</p>

    </div>


   </div>

    <div id="method-list">
      <h3 class="section-bar">Methods</h3>

      <div class="name-list">
      <a href="#M000011">default</a>&nbsp;&nbsp;
      <a href="#M000012">factory_details</a>&nbsp;&nbsp;
      </div>
    </div>

  </div>


    <!-- if includes -->

    <div id="section">





      


    <!-- if method_list -->
    <div id="methods">
      <h3 class="section-bar">Public Instance methods</h3>

      <div id="method-M000011" class="method-detail">
        <a name="M000011"></a>

        <div class="method-heading">
          <a href="#M000011" class="method-signature">
          <span class="method-name">default</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
Default action. The total output quantity for each factory is calculated
using values from the database. This data of factory id, name and total
output is stored in an array for each factory. This array of arrays is
visible to its view.
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000011-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000011-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/fusioncharts/db_js_dataurl_controller.rb, line 23</span>
23:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">default</span>
24:     
25:       <span class="ruby-identifier">headers</span>[<span class="ruby-value str">&quot;content-type&quot;</span>]=<span class="ruby-value str">&quot;text/html&quot;</span>;
26:       <span class="ruby-comment cmt"># Expects a parameter called animate</span>
27:       <span class="ruby-ivar">@animate_chart</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:animate</span>]
28:       <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@animate_chart</span><span class="ruby-operator">==</span><span class="ruby-keyword kw">nil</span> <span class="ruby-keyword kw">or</span> <span class="ruby-ivar">@animate_chart</span>.<span class="ruby-identifier">empty?</span>
29:          <span class="ruby-comment cmt"># Assigns default values as '1'</span>
30:          <span class="ruby-ivar">@animate_chart</span> = <span class="ruby-value str">'1'</span>
31:       <span class="ruby-keyword kw">end</span>  
32:       <span class="ruby-comment cmt">#Initialize the array</span>
33:       <span class="ruby-ivar">@factory_data</span> = []
34:       <span class="ruby-comment cmt"># Get the data in all the columns of FactoryMaster</span>
35:       <span class="ruby-identifier">factory_masters</span> = <span class="ruby-constant">Fusioncharts</span><span class="ruby-operator">::</span><span class="ruby-constant">FactoryMaster</span>. <span class="ruby-identifier">find</span>(<span class="ruby-identifier">:all</span>)
36:       <span class="ruby-comment cmt"># Loop through each factory obtained</span>
37:       <span class="ruby-identifier">factory_masters</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">factory_master</span><span class="ruby-operator">|</span>
38:           <span class="ruby-identifier">factory_id</span> = <span class="ruby-identifier">factory_master</span>.<span class="ruby-identifier">id</span>
39:           <span class="ruby-identifier">factory_name</span> = <span class="ruby-identifier">factory_master</span>.<span class="ruby-identifier">name</span>  
40:           <span class="ruby-identifier">total</span> = <span class="ruby-value">0</span><span class="ruby-value">.0</span>
41:           <span class="ruby-identifier">factory_master</span>.<span class="ruby-identifier">factory_output_quantities</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">factory_output</span><span class="ruby-operator">|</span>
42:             <span class="ruby-comment cmt"># Calculate the total for this factory</span>
43:             <span class="ruby-identifier">total</span> = <span class="ruby-identifier">total</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">factory_output</span>.<span class="ruby-identifier">quantity</span>
44:           <span class="ruby-keyword kw">end</span>
45:           <span class="ruby-ivar">@factory_data</span><span class="ruby-operator">&lt;&lt;</span>{<span class="ruby-identifier">:factory_id=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">factory_id</span>,<span class="ruby-identifier">:factory_name=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">factory_name</span>,<span class="ruby-identifier">:factory_output=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">total</span>}
46:       <span class="ruby-keyword kw">end</span>  
47:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>

      <div id="method-M000012" class="method-detail">
        <a name="M000012"></a>

        <div class="method-heading">
          <a href="#M000012" class="method-signature">
          <span class="method-name">factory_details</span><span class="method-args">()</span>
          </a>
        </div>
      
        <div class="method-description">
          <p>
This action will generate a chart to show the detailed information of the
selected factory. Expects factoryId as parameter in the request
</p>
          <p><a class="source-toggle" href="#"
            onclick="toggleCode('M000012-source');return false;">[Source]</a></p>
          <div class="method-source-code" id="M000012-source">
<pre>
    <span class="ruby-comment cmt"># File app/controllers/fusioncharts/db_js_dataurl_controller.rb, line 51</span>
51:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">factory_details</span>
52:         <span class="ruby-identifier">headers</span>[<span class="ruby-value str">&quot;content-type&quot;</span>]=<span class="ruby-value str">&quot;text/xml&quot;</span>;
53:         <span class="ruby-comment cmt"># Get the factoryId from request using params[]</span>
54:         <span class="ruby-ivar">@factory_id</span> = <span class="ruby-identifier">params</span>[<span class="ruby-identifier">:factoryId</span>]
55:         <span class="ruby-comment cmt">#Initialize the array</span>
56:         <span class="ruby-ivar">@factory_data</span> = []
57:         
58:         <span class="ruby-identifier">factory_master</span> = <span class="ruby-constant">Fusioncharts</span><span class="ruby-operator">::</span><span class="ruby-constant">FactoryMaster</span>. <span class="ruby-identifier">find</span>(<span class="ruby-ivar">@factory_id</span>)
59:                 <span class="ruby-identifier">factory_master</span>.<span class="ruby-identifier">factory_output_quantities</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">factory_output</span><span class="ruby-operator">|</span>
60:                       <span class="ruby-identifier">date_of_production</span> = <span class="ruby-identifier">factory_output</span>.<span class="ruby-identifier">date_pro</span>
61:                       <span class="ruby-comment cmt"># Formats the date to dd/mm without leading zeroes</span>
62:                       <span class="ruby-identifier">formatted_date</span> = <span class="ruby-identifier">format_date_remove_zeroes</span>(<span class="ruby-identifier">date_of_production</span>)
63:                       <span class="ruby-identifier">quantity_number</span> = <span class="ruby-identifier">factory_output</span>.<span class="ruby-identifier">quantity</span>
64:                       <span class="ruby-ivar">@factory_data</span><span class="ruby-operator">&lt;&lt;</span>{<span class="ruby-identifier">:date_of_production=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">formatted_date</span>,<span class="ruby-identifier">:quantity_number=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">quantity_number</span>}
65:                 <span class="ruby-keyword kw">end</span>
66:     <span class="ruby-keyword kw">end</span>
</pre>
          </div>
        </div>
      </div>


    </div>


  </div>


<div id="validator-badges">
  <p><small><a href="http://validator.w3.org/check/referer">[Validate]</a></small></p>
</div>

</body>
</html>